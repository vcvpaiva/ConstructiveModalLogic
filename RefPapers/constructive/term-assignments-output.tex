Given the Natural Deduction system presented in the previous section,
we simply follow the recipes described in \cite{barber1997} to produce
a term assignment for these four kinds of modal operators.

We start by giving a calculus for annotating natural deduction proofs
in our CS4 tense calculus with typed $\lambda$-calculus terms. The
annotations must be such that types correspond to modal propositions,
terms correspond to proofs and proof normalisation corresponds to term
reduction. The basic typying judgements of our CS4 tense calculus are
of the form $\Gamma  \TLLsym{;}  \Delta  \vdash  \TLLnt{t}  \TLLsym{:}  \TLLnt{A}$ where $\Gamma$ declares modal
variables, which may occurr arbitrarily in a term, while $\Delta$
declares intuitionistic variables that may not occurr in a subterm of
the form $\Box \, \TLLnt{t}$ or $\blacksquare \, \TLLnt{t}$.

The typing rules for basic propositional logic can be found in
Figure~\ref{fig:term-assignment-basic}, and the typing rules for the
TCS4 modalities are in Figure~\ref{fig:term-assignment-TCS4}.
Finally, the reduction relation consists of the $\beta$-reduction
rules defined in Figure~\ref{fig:reduction-TCS4}, and the commuting
conversions defined in Figure~\ref{fig:commuting-conv-TCS4}; we omit
congruence rules in the interest of space.
\begin{figure}
  \begin{mdframed}
    \begin{mathpar}
      \TLLdruletyXXax{} \and
      \TLLdruletyXXbax{} \and
      \TLLdruletyXXtrue{} \and
      \TLLdruletyXXfalse{} \and
      \TLLdruletyXXconjI{} \and
      \TLLdruletyXXconjEOne{} \and
      \TLLdruletyXXconjETwo{} \and
      \TLLdruletyXXdisjIOne{} \and
      \TLLdruletyXXdisjITwo{} \and
      \TLLdruletyXXdisjE{} \and
      \TLLdruletyXXimpI{} \and
      \TLLdruletyXXimpE{}      
    \end{mathpar}
  \end{mdframed}
  \caption{Term assignment for basic propositional logic}
  \label{fig:term-assignment-basic}
\end{figure}
\begin{figure}
  \begin{mdframed}
    \begin{mathpar}
      \TLLdruletyXXboxI{} \and
      \TLLdruletyXXboxE{} \and
      \TLLdruletyXXbdiaI{} \and
      \TLLdruletyXXbdiaE{} \and
      \TLLdruletyXXbboxI{} \and
      \TLLdruletyXXbboxE{} \and
      \TLLdruletyXXdiaI{} \and
      \TLLdruletyXXdiaE{}
    \end{mathpar}
  \end{mdframed}
  \caption{Term assignment for TCS4}
  \label{fig:term-assignment-TCS4}
\end{figure}
\begin{figure}
  \begin{mdframed}
    \begin{mathpar}
      \TLLdrulerXXbeta{} \and
      \TLLdrulerXXfirst{} \and
      \TLLdrulerXXsecond{} \and
      \TLLdrulerXXcaseOne{} \and
      \TLLdrulerXXcaseTwo{} \and
      \TLLdrulerXXbox{} \and
      \TLLdrulerXXbdia{} \and
      \TLLdrulerXXbbox{} \and
      \TLLdrulerXXdia{}      
    \end{mathpar}
  \end{mdframed}
  \caption{The $\beta$-reduction rules for TCS4}
  \label{fig:reduction-TCS4}
\end{figure}
\begin{figure}
  \begin{mdframed}
    \begin{mathpar}
      \TLLdrulerXXboxBox{} \and
      \TLLdrulerXXbdiaBdia{} \and
      \TLLdrulerXXboxBBox{} \and
      \TLLdrulerXXdiadia{}
    \end{mathpar}
  \end{mdframed}
  \caption{The commuting conversions for TCS4}
  \label{fig:commuting-conv-TCS4}
\end{figure}
In the remainder of this section we prove various properties of this
system.


\subsection{Subject Reduction}
\label{subsec:subject_reduction}
TCS4 has two different types of assumptions, and hence, of
free variables, those that are members of $\Gamma$ and those that are
members of $\Delta$, where the former are implicitly boxed.  This
implies that there are two types of substitution for typing and
weakening results.
\begin{lemma}[Substitution for Typing]
  \label{lemma:substitution_for_typing}
  \begin{enumerate}[i.]
  \item[] 
  \item If $\Gamma  \TLLsym{;}  \Delta  \vdash  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{:}  \TLLnt{A}$, and $\Gamma  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{;}  \Delta  \vdash  \TLLnt{t_{{\mathrm{2}}}}  \TLLsym{:}  \TLLnt{B}$, then $\Gamma  \TLLsym{;}  \Delta  \vdash  \TLLsym{[}  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{/}  \mathit{x}  \TLLsym{]}  \TLLnt{t_{{\mathrm{2}}}}  \TLLsym{:}  \TLLnt{B}$.
  \item If $\Gamma  \TLLsym{;}  \Delta  \vdash  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{:}  \TLLnt{A}$, and $\Gamma  \TLLsym{;}  \Delta  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \vdash  \TLLnt{t_{{\mathrm{2}}}}  \TLLsym{:}  \TLLnt{B}$, then $\Gamma  \TLLsym{;}  \Delta  \vdash  \TLLsym{[}  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{/}  \mathit{x}  \TLLsym{]}  \TLLnt{t_{{\mathrm{2}}}}  \TLLsym{:}  \TLLnt{B}$.
  \end{enumerate}
\end{lemma}
\begin{proof}
  Both parts of this proof hold by straightforward induction on the
  form of the second assumed typing derivation.  Notice that rules
  $\Box_{\mathcal{I}}$ and $\BBox_{\mathcal{I}}$ do not need to be
  considered in in the proof of part two, because we assume the
  propositional context, $\Delta$, is non-empty.
\end{proof}

\begin{lemma}[Weakening]
  \label{lemma:weakening}
  \begin{enumerate}[i.]
  \item[]
  \item If $\Gamma  \TLLsym{;}  \Delta  \vdash  \TLLnt{t}  \TLLsym{:}  \TLLnt{B}$, then $\Gamma  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{;}  \Delta  \vdash  \TLLnt{t}  \TLLsym{:}  \TLLnt{B}$.
  \item If $\Gamma  \TLLsym{;}  \Delta  \vdash  \TLLnt{t}  \TLLsym{:}  \TLLnt{B}$, then $\Gamma  \TLLsym{;}  \Delta  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \vdash  \TLLnt{t}  \TLLsym{:}  \TLLnt{B}$.
  \end{enumerate}
\end{lemma}
\begin{proof}
  Both parts of this proof hold by straightforward induction on the
  form of the assumed typing derivation.  In the case of the rules
  $\Box_{\mathcal{I}}$ and $\BBox_{\mathcal{I}}$ we simply reapply the
  rule using the assumed premise.
\end{proof}

Next we show subject reduction, but this first requires the following
inversion principles.  Then subject reduction holds by straightforward
induction.
\begin{lemma}[Inversion]
  \label{lemma:inversion}
  \begin{enumerate}[i.]
  \item[]
  \item If $\Gamma  \TLLsym{;}  \Delta  \vdash  \TLLsym{(}  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{,}  \TLLnt{t_{{\mathrm{2}}}}  \TLLsym{)}  \TLLsym{:}   \TLLnt{A}  \land  \TLLnt{B} $, then $\Gamma  \TLLsym{;}  \Delta  \vdash  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{:}  \TLLnt{A}$, and $\Gamma  \TLLsym{;}  \Delta  \vdash  \TLLnt{t_{{\mathrm{2}}}}  \TLLsym{:}  \TLLnt{B}$.
  \item If $\Gamma  \TLLsym{;}  \Delta  \vdash  \mathsf{fst}\, \, \TLLnt{t}  \TLLsym{:}  \TLLnt{B}$, then there is a type $\TLLnt{A}$, such that, $\Gamma  \TLLsym{;}  \Delta  \vdash  \TLLnt{t}  \TLLsym{:}   \TLLnt{A}  \land  \TLLnt{B} $.
  \item If $\Gamma  \TLLsym{;}  \Delta  \vdash  \mathsf{snd}\, \, \TLLnt{t}  \TLLsym{:}  \TLLnt{B}$, then there is a type $\TLLnt{A}$, such that, $\Gamma  \TLLsym{;}  \Delta  \vdash  \TLLnt{t}  \TLLsym{:}   \TLLnt{A}  \land  \TLLnt{B} $.
  \item If $\Gamma  \TLLsym{;}  \Delta  \vdash  \mathsf{inj}_1\,  \TLLnt{t}  \TLLsym{:}   \TLLnt{A}  \lor  \TLLnt{B} $, then $\Gamma  \TLLsym{;}  \Delta  \vdash  \TLLnt{t}  \TLLsym{:}  \TLLnt{A}$.
  \item If $\Gamma  \TLLsym{;}  \Delta  \vdash  \mathsf{inj}_2\,  \TLLnt{t}  \TLLsym{:}   \TLLnt{A}  \lor  \TLLnt{B} $, then $\Gamma  \TLLsym{;}  \Delta  \vdash  \TLLnt{t}  \TLLsym{:}  \TLLnt{B}$.
  \item If $\Gamma  \TLLsym{;}  \Delta  \vdash   \mathsf{case}\, \TLLnt{t} \,\mathsf{of}\, \mathit{x} . \TLLnt{t_{{\mathrm{1}}}} , \mathit{x} . \TLLnt{t_{{\mathrm{2}}}}   \TLLsym{:}  \TLLnt{C}$, then there are types $\TLLnt{A}$ and $\TLLnt{B}$,
    such that, $\Gamma  \TLLsym{;}  \Delta  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \vdash  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{:}  \TLLnt{C}$, $\Gamma  \TLLsym{;}  \Delta  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{B}  \vdash  \TLLnt{t_{{\mathrm{2}}}}  \TLLsym{:}  \TLLnt{C}$, and $\Gamma  \TLLsym{;}  \Delta  \vdash  \TLLnt{t}  \TLLsym{:}   \TLLnt{A}  \lor  \TLLnt{B} $.
  \item If $\Gamma  \TLLsym{;}  \Delta  \vdash   \lambda  \mathit{x}  :  \TLLnt{A} . \TLLnt{t}   \TLLsym{:}  \TLLnt{B}$, then $\Gamma  \TLLsym{;}  \Delta  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \vdash  \TLLnt{t}  \TLLsym{:}  \TLLnt{B}$.    
  \item If $\Gamma  \TLLsym{;}  \Delta  \vdash  \TLLnt{t_{{\mathrm{1}}}} \, \TLLnt{t_{{\mathrm{2}}}}  \TLLsym{:}  \TLLnt{B}$, then there exists a type $\TLLnt{A}$, such that, $\Gamma  \TLLsym{;}  \Delta  \vdash  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{:}  \TLLnt{A}  \to  \TLLnt{B}$ and $\Gamma  \TLLsym{;}  \Delta  \vdash  \TLLnt{t_{{\mathrm{2}}}}  \TLLsym{:}  \TLLnt{A}$.
  \item If $\Gamma  \TLLsym{;}  \Delta  \vdash  \Box \, \TLLnt{t}  \TLLsym{:}  \Box \, \TLLnt{A}$, then $\Gamma  \TLLsym{;}  \emptyset  \vdash  \TLLnt{t}  \TLLsym{:}  \TLLnt{A}$.
  \item If $\Gamma  \TLLsym{;}  \Delta  \vdash   \mathsf{let}\,\Box  \mathit{x}  =  \TLLnt{t_{{\mathrm{1}}}} \,\mathsf{in}\, \TLLnt{t_{{\mathrm{2}}}}   \TLLsym{:}  \TLLnt{B}$, then there is a type $\TLLnt{A}$, such that,
    $\Gamma  \TLLsym{;}  \Delta  \vdash  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{:}  \Box \, \TLLnt{A}$ and $\Gamma  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{;}  \Delta  \vdash  \TLLnt{t_{{\mathrm{2}}}}  \TLLsym{:}  \TLLnt{B}$.
  \item If $\Gamma  \TLLsym{;}  \Delta  \vdash  \mathbin{\blacklozenge} \, \TLLnt{t}  \TLLsym{:}  \mathbin{\blacklozenge} \, \TLLnt{A}$, then $\Gamma  \TLLsym{;}  \Delta  \vdash  \TLLnt{t}  \TLLsym{:}  \TLLnt{A}$.
  \item If $\Gamma  \TLLsym{;}  \Delta  \vdash   \mathsf{let}\,\blacklozenge  \mathit{x}  =  \TLLnt{t_{{\mathrm{1}}}} \,\mathsf{in}\, \TLLnt{t_{{\mathrm{2}}}}   \TLLsym{:}  \TLLnt{B}$, then there is a type $\TLLnt{A}$, such that,
    $\Gamma  \TLLsym{;}  \Delta  \vdash  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{:}  \mathbin{\blacklozenge} \, \TLLnt{A}$ and $\Gamma  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{;}  \Delta  \vdash  \TLLnt{t_{{\mathrm{2}}}}  \TLLsym{:}  \TLLnt{B}$.
  \item If $\Gamma  \TLLsym{;}  \Delta  \vdash  \blacksquare \, \TLLnt{t}  \TLLsym{:}  \blacksquare \, \TLLnt{A}$, then $\Gamma  \TLLsym{;}  \emptyset  \vdash  \TLLnt{t}  \TLLsym{:}  \TLLnt{A}$.
  \item If $\Gamma  \TLLsym{;}  \Delta  \vdash   \mathsf{let}\,\blacksquare  \mathit{x}  =  \TLLnt{t_{{\mathrm{1}}}} \,\mathsf{in}\, \TLLnt{t_{{\mathrm{2}}}}   \TLLsym{:}  \TLLnt{B}$, then there is a type $\TLLnt{A}$, such that,
    $\Gamma  \TLLsym{;}  \Delta  \vdash  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{:}  \blacksquare \, \TLLnt{A}$ and $\Gamma  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{;}  \Delta  \vdash  \TLLnt{t_{{\mathrm{2}}}}  \TLLsym{:}  \TLLnt{B}$.
  \item If $\Gamma  \TLLsym{;}  \Delta  \vdash  \Diamond \, \TLLnt{t}  \TLLsym{:}  \Diamond \, \TLLnt{A}$, then $\Gamma  \TLLsym{;}  \Delta  \vdash  \TLLnt{t}  \TLLsym{:}  \TLLnt{A}$.
  \item If $\Gamma  \TLLsym{;}  \Delta  \vdash   \mathsf{let}\,\Diamond  \mathit{x}  =  \TLLnt{t_{{\mathrm{1}}}} \,\mathsf{in}\, \TLLnt{t_{{\mathrm{2}}}}   \TLLsym{:}  \TLLnt{B}$, then there is a type $\TLLnt{A}$, such that,
    $\Gamma  \TLLsym{;}  \Delta  \vdash  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{:}  \Diamond \, \TLLnt{A}$ and $\Gamma  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{;}  \Delta  \vdash  \TLLnt{t_{{\mathrm{2}}}}  \TLLsym{:}  \TLLnt{B}$.
  \end{enumerate}
\end{lemma}
\begin{proof}
  Each of these principles hold by a simple induction over the assumed
  typing derivation.
\end{proof}

\begin{lemma}[Subject Reduction]
  \label{lemma:subject_reduction}
  If $\Gamma  \TLLsym{;}  \Delta  \vdash  \TLLnt{t}  \TLLsym{:}  \TLLnt{A}$ and $\TLLnt{t}  \rightsquigarrow  \TLLnt{t'}$, then $\Gamma  \TLLsym{;}  \Delta  \vdash  \TLLnt{t'}  \TLLsym{:}  \TLLnt{A}$.
\end{lemma}
\begin{proof}
  This proof holds by induction on the assumed typing derivation; see
  the Appendix~\ref{subsec:proof_of_subject_reduction} for the
  complete proof.
\end{proof}
% subsection subject_reduction (end)
