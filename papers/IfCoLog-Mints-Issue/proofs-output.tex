\subsubsection{Proof of Substitution for Typing}
\label{sec:proof_of_lemma:substitution_for_typing}

\begin{lemma*}[Substitution for Typing]
  If $\Gamma_{{\mathrm{1}}}  \vdash  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{:}  \TLLnt{A}$, and $\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLnt{t_{{\mathrm{2}}}}  \TLLsym{:}  \TLLnt{B}$, then $\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLsym{[}  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{/}  \mathit{x}  \TLLsym{]}  \TLLnt{t_{{\mathrm{2}}}}  \TLLsym{:}  \TLLnt{B}$.
\end{lemma*}

\begin{proof}
  Suppose $\Gamma_{{\mathrm{1}}}  \vdash  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{:}  \TLLnt{A}$ and $\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLnt{t_{{\mathrm{2}}}}  \TLLsym{:}  \TLLnt{B}$.  We case
split on the structure of the latter.
\begin{itemize}
\item[] Case.\\ 
  \begin{center}
    \begin{math}
      $$\mprset{flushleft}
      \inferrule* [right=$\text{Id}$] {
        \ 
      }{\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \mathit{y}  \TLLsym{:}  \TLLnt{C}}
    \end{math}
  \end{center}
  In this case $\TLLnt{t_{{\mathrm{2}}}} = \mathit{y}$ and $\TLLnt{B} = \TLLnt{C}$.  We are not
  sure if $\mathit{x} = \mathit{y}$, thus, we must consider the case when they
  are and are not equal.

  Suppose $\mathit{x} \neq \mathit{y}$.  Then $\TLLsym{[}  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{/}  \mathit{x}  \TLLsym{]}  \TLLnt{t_{{\mathrm{2}}}} = \TLLsym{[}  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{/}  \mathit{x}  \TLLsym{]}  \mathit{y} =
  \mathit{y}$ by the definition of substitution.  In addition, it must be
  the case that either $\mathit{y}  \TLLsym{:}  \TLLnt{C} \in \Gamma_{{\mathrm{1}}}$ or $\mathit{y}  \TLLsym{:}  \TLLnt{C} \in
  \Gamma_{{\mathrm{2}}}$.  This implies that $\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \mathit{y}  \TLLsym{:}  \TLLnt{C}$ or $\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLsym{[}  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{/}  \mathit{x}  \TLLsym{]}  \TLLnt{t_{{\mathrm{2}}}}  \TLLsym{:}  \TLLnt{B}$ hold.

  Now suppose $\mathit{x} = \mathit{y}$.  Then $\TLLnt{A} = \TLLnt{B}$, and $\TLLsym{[}  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{/}  \mathit{x}  \TLLsym{]}  \TLLnt{t_{{\mathrm{2}}}} = \TLLsym{[}  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{/}  \mathit{x}  \TLLsym{]}  \mathit{x} = \TLLnt{t_{{\mathrm{1}}}}$ by the definition of
  substitution.  Thus, $\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLsym{[}  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{/}  \mathit{x}  \TLLsym{]}  \TLLnt{t_{{\mathrm{2}}}}  \TLLsym{:}  \TLLnt{B}$ holds, because we
  know $\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{:}  \TLLnt{A}$.

\item[] Case.\\ 
  \begin{center}
    \begin{math}
      $$\mprset{flushleft}
      \inferrule* [right=$\perp_\mathcal{E}$] {
        \ 
      }{\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \TLLsym{,}  \mathit{y}  \TLLsym{:}  \perp  \vdash   \mathsf{contra}   \TLLsym{:}  \TLLnt{C}}
    \end{math}
  \end{center}
  We must show that $\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \TLLsym{,}  \mathit{y}  \TLLsym{:}  \perp  \vdash  \TLLsym{[}  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{/}  \mathit{x}  \TLLsym{]}   \mathsf{contra}   \TLLsym{:}  \TLLnt{C}$ holds,
  because $\TLLnt{B} = \TLLnt{C}$ and $\TLLnt{t_{{\mathrm{2}}}} =  \mathsf{contra} $, but this holds
  by reapplying the rule.


\item[] Case.\\ 
  \begin{center}
    \begin{math}
      $$\mprset{flushleft}
      \inferrule* [right=$\TLLdruletyXXimpIName$] {
        \Gamma_{{\mathrm{1}}}  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \TLLsym{,}  \mathit{y}  \TLLsym{:}  \TLLnt{C_{{\mathrm{1}}}}  \vdash  \TLLnt{t}  \TLLsym{:}  \TLLnt{C_{{\mathrm{2}}}}
      }{\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash   \lambda  \mathit{y}  :  \TLLnt{C_{{\mathrm{1}}}} . \TLLnt{t}   \TLLsym{:}  \TLLnt{C_{{\mathrm{1}}}}  \to  \TLLnt{C_{{\mathrm{2}}}}}
    \end{math}
  \end{center}
  In this case $\TLLnt{B} = \TLLnt{C_{{\mathrm{1}}}}  \to  \TLLnt{C_{{\mathrm{2}}}}$ and $\TLLnt{t_{{\mathrm{2}}}} =  \lambda  \mathit{y}  :  \TLLnt{C} . \TLLnt{t} $.  By the induction hypothesis
  we know $\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \TLLsym{,}  \mathit{y}  \TLLsym{:}  \TLLnt{C_{{\mathrm{1}}}}  \vdash  \TLLsym{[}  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{/}  \mathit{x}  \TLLsym{]}  \TLLnt{t}  \TLLsym{:}  \TLLnt{C_{{\mathrm{2}}}}$, and then by reapplying the rule we know
  $\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash   \lambda  \mathit{y}  :  \TLLnt{C_{{\mathrm{1}}}} . \TLLsym{[}  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{/}  \mathit{x}  \TLLsym{]}  \TLLnt{t}   \TLLsym{:}  \TLLnt{C_{{\mathrm{2}}}}$ holds.  However, by the definition of substitution
  we know $ \lambda  \mathit{y}  :  \TLLnt{C_{{\mathrm{1}}}} . \TLLsym{[}  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{/}  \mathit{x}  \TLLsym{]}  \TLLnt{t}  = \TLLsym{[}  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{/}  \mathit{x}  \TLLsym{]}  \TLLsym{(}   \lambda  \mathit{y}  :  \TLLnt{C_{{\mathrm{1}}}} . \TLLnt{t}   \TLLsym{)}$, and thus, we obtain our result.

\item[] Case.\\ 
  \begin{center}
    \begin{math}
      $$\mprset{flushleft}
      \inferrule* [right=$\TLLdruletyXXimpEName$] {
        \Gamma_{{\mathrm{1}}}  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLnt{t'_{{\mathrm{1}}}}  \TLLsym{:}  \TLLnt{C_{{\mathrm{1}}}}  \to  \TLLnt{C_{{\mathrm{2}}}}  \quad  \Gamma_{{\mathrm{1}}}  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLnt{t'_{{\mathrm{2}}}}  \TLLsym{:}  \TLLnt{C_{{\mathrm{1}}}}
      }{\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLnt{t'_{{\mathrm{1}}}} \, \TLLnt{t'_{{\mathrm{2}}}}  \TLLsym{:}  \TLLnt{C_{{\mathrm{2}}}}}
    \end{math}
  \end{center}
  We now have that $\TLLnt{B} = \TLLnt{C_{{\mathrm{2}}}}$ and $\TLLnt{t_{{\mathrm{2}}}} = \TLLnt{t'_{{\mathrm{1}}}} \, \TLLnt{t'_{{\mathrm{2}}}}$.  By the induction hypothesis
  we know that $\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLsym{[}  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{/}  \mathit{x}  \TLLsym{]}  \TLLnt{t'_{{\mathrm{1}}}}  \TLLsym{:}  \TLLnt{C_{{\mathrm{1}}}}  \to  \TLLnt{C_{{\mathrm{2}}}}$ and $\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLsym{[}  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{/}  \mathit{x}  \TLLsym{]}  \TLLnt{t'_{{\mathrm{2}}}}  \TLLsym{:}  \TLLnt{C_{{\mathrm{1}}}}$ both hold.
  Then by reapplying the rule we obtain that $\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLsym{(}  \TLLsym{[}  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{/}  \mathit{x}  \TLLsym{]}  \TLLnt{t'_{{\mathrm{1}}}}  \TLLsym{)} \, \TLLsym{(}  \TLLsym{[}  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{/}  \mathit{x}  \TLLsym{]}  \TLLnt{t'_{{\mathrm{2}}}}  \TLLsym{)}  \TLLsym{:}  \TLLnt{C_{{\mathrm{2}}}}$, and thus,
  by the definition of substitution $\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLsym{[}  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{/}  \mathit{x}  \TLLsym{]}  \TLLsym{(}  \TLLnt{t'_{{\mathrm{1}}}} \, \TLLnt{t'_{{\mathrm{2}}}}  \TLLsym{)}  \TLLsym{:}  \TLLnt{C_{{\mathrm{2}}}}$ holds.
  
  
\item[] Case.\\ 
  \begin{center}
    \scriptsize
    \begin{math}
      $$\mprset{flushleft}
      \inferrule* [right=$\TLLdruletyXXboxIName$] {
         \Gamma_{{\mathrm{1}}}  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLnt{t'_{{\mathrm{1}}}}  \TLLsym{:}  \Box \, \TLLnt{C_{{\mathrm{1}}}}  \TLLsym{,} \, ... \, \TLLsym{,}  \Gamma_{{\mathrm{1}}}  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLnt{t'_{\TLLmv{k}}}  \TLLsym{:}  \Box \, \TLLnt{C_{\TLLmv{k}}}   \quad  \mathit{x_{{\mathrm{1}}}}  \TLLsym{:}  \Box \, \TLLnt{C_{{\mathrm{1}}}}  \TLLsym{,} \, ... \, \TLLsym{,}  \mathit{x_{\TLLmv{k}}}  \TLLsym{:}  \Box \, \TLLnt{C_{\TLLmv{k}}}  \vdash  \TLLnt{t}  \TLLsym{:}  \TLLnt{C}
      }{\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash   \mathsf{let}_\Box\, \mathit{x_{{\mathrm{1}}}}  \TLLsym{:}  \Box \, \TLLnt{C_{{\mathrm{1}}}}  \TLLsym{,} \, ... \, \TLLsym{,}  \mathit{x_{\TLLmv{k}}}  \TLLsym{:}  \Box \, \TLLnt{C_{\TLLmv{k}}} \,\mathsf{be}\, \TLLnt{t'_{{\mathrm{1}}}}  \TLLsym{,} \, ... \, \TLLsym{,}  \TLLnt{t'_{\TLLmv{k}}} \,\mathsf{in}\, \TLLnt{t}   \TLLsym{:}  \Box \, \TLLnt{C}}
    \end{math}
  \end{center}
  In this case $\TLLnt{B} = \Box \, \TLLnt{C}$ and
  $\TLLnt{t_{{\mathrm{2}}}} =  \mathsf{let}_\Box\, \mathit{x_{{\mathrm{1}}}}  \TLLsym{:}  \Box \, \TLLnt{C_{{\mathrm{1}}}}  \TLLsym{,} \, ... \, \TLLsym{,}  \mathit{x_{\TLLmv{k}}}  \TLLsym{:}  \Box \, \TLLnt{C_{\TLLmv{k}}} \,\mathsf{be}\, \TLLnt{t'_{{\mathrm{1}}}}  \TLLsym{,} \, ... \, \TLLsym{,}  \TLLnt{t'_{\TLLmv{k}}} \,\mathsf{in}\, \TLLnt{t} $.  By the induction hypothesis
  we know that 
  \[ \Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLsym{[}  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{/}  \mathit{x}  \TLLsym{]}  \TLLnt{t'_{{\mathrm{1}}}}  \TLLsym{:}  \Box \, \TLLnt{C_{{\mathrm{1}}}} , \ldots , \Gamma_{{\mathrm{1}}}  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLsym{[}  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{/}  \mathit{x}  \TLLsym{]}  \TLLnt{t'_{\TLLmv{k}}}  \TLLsym{:}  \Box \, \TLLnt{C_{\TLLmv{k}}} \] all hold. Then by reapplying
  the rule we know that
  \[ \Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash   \mathsf{let}_\Box\, \mathit{x_{{\mathrm{1}}}}  \TLLsym{:}  \Box \, \TLLnt{C_{{\mathrm{1}}}}  \TLLsym{,} \, ... \, \TLLsym{,}  \mathit{x_{\TLLmv{k}}}  \TLLsym{:}  \Box \, \TLLnt{C_{\TLLmv{k}}} \,\mathsf{be}\, \TLLsym{[}  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{/}  \mathit{x}  \TLLsym{]}  \TLLnt{t'_{{\mathrm{1}}}}  \TLLsym{,} \, ... \, \TLLsym{,}  \TLLsym{[}  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{/}  \mathit{x}  \TLLsym{]}  \TLLnt{t'_{\TLLmv{k}}} \,\mathsf{in}\, \TLLnt{t}   \TLLsym{:}  \Box \, \TLLnt{C}, \] but by the definition
  of substitution and the fact that $\TLLsym{[}  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{/}  \mathit{x}  \TLLsym{]}  \TLLnt{t} = \TLLnt{t}$ because $\TLLnt{t}$ does not depend on $\mathit{x}$ we know that
  \[ \Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLsym{[}  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{/}  \mathit{x}  \TLLsym{]}  \TLLsym{(}   \mathsf{let}_\Box\, \mathit{x_{{\mathrm{1}}}}  \TLLsym{:}  \Box \, \TLLnt{C_{{\mathrm{1}}}}  \TLLsym{,} \, ... \, \TLLsym{,}  \mathit{x_{\TLLmv{k}}}  \TLLsym{:}  \Box \, \TLLnt{C_{\TLLmv{k}}} \,\mathsf{be}\, \TLLnt{t'_{{\mathrm{1}}}}  \TLLsym{,} \, ... \, \TLLsym{,}  \TLLnt{t'_{\TLLmv{k}}} \,\mathsf{in}\, \TLLnt{t}   \TLLsym{)}  \TLLsym{:}  \Box \, \TLLnt{C} \] holds.
  
\item[] Case.\\ 
  \begin{center}
    \begin{math}
      $$\mprset{flushleft}
      \inferrule* [right=$\TLLdruletyXXboxEName$] {
        \Gamma_{{\mathrm{1}}}  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLnt{t}  \TLLsym{:}  \Box \, \TLLnt{C}
      }{\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \mathsf{unbox}_\Box\, \, \TLLnt{t}  \TLLsym{:}  \TLLnt{C}}
    \end{math}
  \end{center}
  This case easily follows by first applying the induction hypothesis and reapplying the rule.

\item[] Case.\\ 
  \begin{center}
    \scriptsize
    \begin{math}
      $$\mprset{flushleft}
      \inferrule* [right=$\TLLdruletyXXbboxIName$] {
         \Gamma_{{\mathrm{1}}}  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{:}  \blacksquare \, \TLLnt{C_{{\mathrm{1}}}}  \TLLsym{,} \, ... \, \TLLsym{,}  \Gamma_{{\mathrm{1}}}  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLnt{t_{\TLLmv{k}}}  \TLLsym{:}  \blacksquare \, \TLLnt{C_{\TLLmv{k}}}   \quad  \mathit{x_{{\mathrm{1}}}}  \TLLsym{:}  \blacksquare \, \TLLnt{C_{{\mathrm{1}}}}  \TLLsym{,} \, ... \, \TLLsym{,}  \mathit{x_{\TLLmv{k}}}  \TLLsym{:}  \blacksquare \, \TLLnt{C_{\TLLmv{k}}}  \vdash  \TLLnt{t}  \TLLsym{:}  \TLLnt{C}
      }{\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash   \mathsf{let}_\blacksquare\, \mathit{x_{{\mathrm{1}}}}  \TLLsym{:}  \blacksquare \, \TLLnt{C_{{\mathrm{1}}}}  \TLLsym{,} \, ... \, \TLLsym{,}  \mathit{x_{\TLLmv{k}}}  \TLLsym{:}  \blacksquare \, \TLLnt{C_{\TLLmv{k}}} \,\mathsf{be}\, \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{,} \, ... \, \TLLsym{,}  \TLLnt{t_{\TLLmv{k}}} \,\mathsf{in}\, \TLLnt{t}   \TLLsym{:}  \blacksquare \, \TLLnt{C}}
    \end{math}
  \end{center}
  This case is similar to the case for $\TLLdruletyXXboxIName$.

\item[] Case.\\ 
  \begin{center}
    \begin{math}
      $$\mprset{flushleft}
      \inferrule* [right=$\TLLdruletyXXbboxEName$] {
        \Gamma_{{\mathrm{1}}}  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLnt{t}  \TLLsym{:}  \blacksquare \, \TLLnt{C}
      }{\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \mathsf{unbox}_\blacksquare\, \, \TLLnt{t}  \TLLsym{:}  \TLLnt{C}}
    \end{math}
  \end{center}
  This case is similar to the case for $\TLLdruletyXXboxEName$.
\end{itemize}
\end{proof}
% subsubsection proof_of_lemma_substitution_for_typing (end)

\subsubsection{Proof of Weakening}
\label{subsubsec:proof_of_lemma:weakening}

\begin{lemma*}[Weakening]
  If $\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLnt{t}  \TLLsym{:}  \TLLnt{B}$, then $\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLnt{t}  \TLLsym{:}  \TLLnt{B}$.
\end{lemma*}

\begin{proof}
  This proof is by induction on the form of $\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLnt{t}  \TLLsym{:}  \TLLnt{B}$.
\begin{itemize}
\item[] Case.\\ 
  \begin{center}
    \begin{math}
      $$\mprset{flushleft}
      \inferrule* [right=$\TLLdruletyXXaxName$] {
        \ 
      }{\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \TLLsym{,}  \mathit{y}  \TLLsym{:}  \TLLnt{C}  \vdash  \mathit{y}  \TLLsym{:}  \TLLnt{C}}
    \end{math}
  \end{center}
  In this case we have that $\TLLnt{B} = \TLLnt{C}$ and $\TLLnt{t} = \mathit{y}$.  We
  must show that $\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \TLLsym{,}  \mathit{y}  \TLLsym{:}  \TLLnt{C}  \vdash  \mathit{y}  \TLLsym{:}  \TLLnt{C}$ holds, but this
  clearly holds by reapplying the rule.

\item[] Case.\\ 
  \begin{center}
    \begin{math}
      $$\mprset{flushleft}
      \inferrule* [right=$\TLLdruletyXXfalseName$] {
        \ 
      }{\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \TLLsym{,}  \mathit{y}  \TLLsym{:}  \perp  \vdash   \mathsf{contra}   \TLLsym{:}  \TLLnt{C}}
    \end{math}
  \end{center}
  Similar to the previous case.

\item[] Case.\\ 
  \begin{center}
    \begin{math}
      $$\mprset{flushleft}
      \inferrule* [right=$\TLLdruletyXXimpIName$] {
        \Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \TLLsym{,}  \mathit{y}  \TLLsym{:}  \TLLnt{C_{{\mathrm{1}}}}  \vdash  \TLLnt{t'}  \TLLsym{:}  \TLLnt{C_{{\mathrm{2}}}}
      }{\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash   \lambda  \mathit{y}  :  \TLLnt{C_{{\mathrm{1}}}} . \TLLnt{t'}   \TLLsym{:}  \TLLnt{C_{{\mathrm{1}}}}  \to  \TLLnt{C_{{\mathrm{2}}}}}
    \end{math}
  \end{center}
  In this case $\TLLnt{B} = \TLLnt{C_{{\mathrm{1}}}}  \to  \TLLnt{C_{{\mathrm{2}}}}$ and $\TLLnt{t} =  \lambda  \mathit{y}  :  \TLLnt{C_{{\mathrm{1}}}} . \TLLnt{t'} $.  By the induction hypothesis
  $\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \TLLsym{,}  \mathit{y}  \TLLsym{:}  \TLLnt{C_{{\mathrm{1}}}}  \vdash  \TLLnt{t'}  \TLLsym{:}  \TLLnt{C_{{\mathrm{2}}}}$ holds, and then by reapplying the rule
  $\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash   \lambda  \mathit{y}  :  \TLLnt{C_{{\mathrm{1}}}} . \TLLnt{t'}   \TLLsym{:}  \TLLnt{C_{{\mathrm{2}}}}$ holds.

\item[] Case.\\ 
  \begin{center}
    \begin{math}
      $$\mprset{flushleft}
      \inferrule* [right=$\TLLdruletyXXimpEName$] {
        \Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{:}  \TLLnt{C_{{\mathrm{1}}}}  \to  \TLLnt{C_{{\mathrm{2}}}}  \quad  \Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLnt{t_{{\mathrm{2}}}}  \TLLsym{:}  \TLLnt{C_{{\mathrm{1}}}}
      }{\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLnt{t_{{\mathrm{1}}}} \, \TLLnt{t_{{\mathrm{2}}}}  \TLLsym{:}  \TLLnt{C_{{\mathrm{2}}}}}
    \end{math}
  \end{center}
  By the induction hypothesis $\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{:}  \TLLnt{C_{{\mathrm{1}}}}  \to  \TLLnt{C_{{\mathrm{2}}}}$ and
  $\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLnt{t_{{\mathrm{2}}}}  \TLLsym{:}  \TLLnt{C_{{\mathrm{1}}}}$, and thus by reapplying the rule
  $\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \mathit{x}  \TLLsym{:}  \TLLnt{A}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLnt{t_{{\mathrm{1}}}} \, \TLLnt{t_{{\mathrm{2}}}}  \TLLsym{:}  \TLLnt{C_{{\mathrm{2}}}}$.


\item[] Case.\\ 
  \begin{center}
    \scriptsize
    \begin{math}
      $$\mprset{flushleft}
      \inferrule* [right=$\TLLdruletyXXboxIName$] {
         \Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{:}  \Box \, \TLLnt{C_{{\mathrm{1}}}}  \TLLsym{,} \, ... \, \TLLsym{,}  \Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLnt{t_{\TLLmv{k}}}  \TLLsym{:}  \Box \, \TLLnt{C_{\TLLmv{k}}}   \quad  \mathit{x_{{\mathrm{1}}}}  \TLLsym{:}  \Box \, \TLLnt{C_{{\mathrm{1}}}}  \TLLsym{,} \, ... \, \TLLsym{,}  \mathit{x_{\TLLmv{k}}}  \TLLsym{:}  \Box \, \TLLnt{C_{\TLLmv{k}}}  \vdash  \TLLnt{t'}  \TLLsym{:}  \TLLnt{C}
      }{\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash   \mathsf{let}_\Box\, \mathit{x_{{\mathrm{1}}}}  \TLLsym{:}  \Box \, \TLLnt{C_{{\mathrm{1}}}}  \TLLsym{,} \, ... \, \TLLsym{,}  \mathit{x_{\TLLmv{k}}}  \TLLsym{:}  \Box \, \TLLnt{C_{\TLLmv{k}}} \,\mathsf{be}\, \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{,} \, ... \, \TLLsym{,}  \TLLnt{t_{\TLLmv{k}}} \,\mathsf{in}\, \TLLnt{t'}   \TLLsym{:}  \Box \, \TLLnt{C}}
    \end{math}
  \end{center}
  This case is similar to the previous case.  First, apply the
  induction hypothesis to the left-most premise, and then reapply
  the rule.

\item[] Case.\\ 
  \begin{center}
    \begin{math}
      $$\mprset{flushleft}
      \inferrule* [right=$\TLLdruletyXXboxEName$] {
        \Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLnt{t'}  \TLLsym{:}  \Box \, \TLLnt{C}
      }{\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \mathsf{unbox}_\Box\, \, \TLLnt{t'}  \TLLsym{:}  \TLLnt{C}}
    \end{math}
  \end{center}      
  Similar to the previous cases.
  
\item[] Case.\\ 
  \begin{center}
    \scriptsize
    \begin{math}
      $$\mprset{flushleft}
      \inferrule* [right=$\TLLdruletyXXbboxIName$] {
         \Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{:}  \blacksquare \, \TLLnt{C_{{\mathrm{1}}}}  \TLLsym{,} \, ... \, \TLLsym{,}  \Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLnt{t_{\TLLmv{k}}}  \TLLsym{:}  \blacksquare \, \TLLnt{C_{\TLLmv{k}}}   \quad  \mathit{x_{{\mathrm{1}}}}  \TLLsym{:}  \blacksquare \, \TLLnt{C_{{\mathrm{1}}}}  \TLLsym{,} \, ... \, \TLLsym{,}  \mathit{x_{\TLLmv{k}}}  \TLLsym{:}  \blacksquare \, \TLLnt{C_{\TLLmv{k}}}  \vdash  \TLLnt{t'}  \TLLsym{:}  \TLLnt{C}
      }{\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash   \mathsf{let}_\blacksquare\, \mathit{x_{{\mathrm{1}}}}  \TLLsym{:}  \blacksquare \, \TLLnt{C_{{\mathrm{1}}}}  \TLLsym{,} \, ... \, \TLLsym{,}  \mathit{x_{\TLLmv{k}}}  \TLLsym{:}  \blacksquare \, \TLLnt{C_{\TLLmv{k}}} \,\mathsf{be}\, \TLLnt{t_{{\mathrm{1}}}}  \TLLsym{,} \, ... \, \TLLsym{,}  \TLLnt{t_{\TLLmv{k}}} \,\mathsf{in}\, \TLLnt{t'}   \TLLsym{:}  \blacksquare \, \TLLnt{C}}
    \end{math}
  \end{center}
  Similar to the case for $\TLLdruletyXXboxIName$.

\item[] Case.\\ 
  \begin{center}
    \begin{math}
      $$\mprset{flushleft}
      \inferrule* [right=$\TLLdruletyXXbboxEName$] {
        \Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \TLLnt{t'}  \TLLsym{:}  \blacksquare \, \TLLnt{C}
      }{\Gamma_{{\mathrm{1}}}  \TLLsym{,}  \Gamma_{{\mathrm{2}}}  \vdash  \mathsf{unbox}_\blacksquare\, \, \TLLnt{t'}  \TLLsym{:}  \TLLnt{C}}
    \end{math}
  \end{center}
  Similar to the case for $\TLLdruletyXXboxEName$.

\end{itemize}
\end{proof}
% subsubsection proof_of_lemma:weakening (end)

\subsubsection{Proof of Soundness of $\sf{TCS4}$}
\label{subsec:proof_of_soundness_of_tcs4}

\begin{theorem*}
The type theory $\sf{TCS4}$ has \textit{sound} models provided by the
structures $\cal C$ defined above.  In other words, given a tense
adjoint modal category $\cal C$, using the above interpretation, the
following hold:
\begin{itemize}
\item Assume $\Gamma \vdash t : A$ in $\sf{TCS4}$. Then $\sem{\Gamma
  \vdash t \colon A}$ is a morphism with domain $\sem{\Gamma}$ and
  codomain $\sem{A}$;
\item Assume $\Gamma \vdash t = s \colon A$. Then $\sem{\Gamma
  \vdash t \colon A} = \sem{\Gamma \vdash s \colon A}$.
\end{itemize}
\end{theorem*}
\begin{proof}
  The first part holds by induction on $\Gamma  \vdash  \TLLnt{t}  \TLLsym{:}  \TLLnt{A}$, and the
  second by induction on $ \Gamma  \vdash  \TLLnt{t}  =  \TLLnt{s}  :  \TLLnt{A} $.  We give a few cases of
  each part here, but the others are similar.  Throughout the proof we
  drop semantic brackets on objects, and we assume without loss of
  generality that the interpretation of contexts are left associated.
  We begin with the first part.

  \begin{itemize}
  \item[] Case.\\
    \[
    \TLLdruletyXXax{}
    \]
    It suffices to find a morphism $\Gamma \times \TLLnt{A} \mto^{f}
    \TLLnt{A}$.  Choose $f = \pi_2$ (the $2$nd projection).

    \item[] Case.\\
    \[
    \TLLdruletyXXimpI{}
    \]
    By the induction hypothesis we know that there is a morphism
    $\Gamma \times \TLLnt{A} \mto^f \TLLnt{B}$.  Then it suffices to find a
    morphism $\Gamma \mto^{g} (\TLLnt{A}  \to  \TLLnt{B})$.  Choose $g =
    \mathsf{curry}(f)$ where $\mathsf{curry} :
    \mathsf{Hom}_{\cat{C}}( \TLLnt{A}  \times  \TLLnt{B} ,\TLLnt{C}) \mto
    \mathsf{Hom}_{\cat{C}}(\TLLnt{A},\TLLnt{B}  \to  \TLLnt{C})$ is a natural isomorphism
    that exists because $\cat{C}$ is closed.

  \item[] Case.\\
    \[
    \TLLdruletyXXboxI{}
    \]

    By the induction hypothesis we have the family of morphisms $\Gamma
    \mto^{f_1} \Box \, \TLLnt{A_{{\mathrm{1}}}}, \ldots, \Gamma \mto^{f_k} \Box \, \TLLnt{A_{\TLLmv{k}}}$, and
    $\Box \, \TLLnt{A_{{\mathrm{1}}}} \times \cdots \times \Box \, \TLLnt{A_{\TLLmv{k}}} \mto^f \TLLnt{B}$.  It
    suffices to find a morphism $\Gamma \mto^{g} \TLLnt{B}$.  Choose $g =
    \langle f_1;\delta_{\TLLnt{A_{{\mathrm{1}}}}},\ldots,f_k;\delta_{\TLLnt{A_{\TLLmv{k}}}} \rangle;\mathsf{m};\Box f$, where $\langle -,-\rangle :
    \mathsf{Hom}_{\cat{C}}(\Gamma,\Box \, \TLLnt{A_{{\mathrm{1}}}}) \times \cdots \times
    \mathsf{Hom}_{\cat{C}}(\Gamma,\Box \, \TLLnt{A_{\TLLmv{k}}}) \mto \mathsf{Hom}_{\cat{C}}(\Gamma,\Box \, \TLLnt{A_{{\mathrm{1}}}}
    \times \cdots \times \Box \, \TLLnt{A_{\TLLmv{k}}})$ exists because $\cat{C}$ is cartesian.

  \item[] Case.\\
    \[
    \TLLdruletyXXboxE{}
    \]
    By the induction hypothesis there is a morphism $\Gamma \mto^f
    \Box \, \TLLnt{B}$.  It suffices to find a morphism $\Gamma \mto^{g}
    \TLLnt{B}$.  Choose $g = f;\eta_B$ where $\eta_B : \Box \, \TLLnt{B} \mto \TLLnt{B}$
    is the unit of the adjunction.
  \end{itemize}

  We now turn to the second part:
  \begin{itemize}
  \item[] Case.\\
    {\scriptsize
      \begin{mathpar}
        \TLLdruleeqXXunbox{}
      \end{mathpar}
    }
    Using the interpretations given above we must show that:
    \[
    \langle f_1;\delta_{\TLLnt{A_{{\mathrm{1}}}}},\ldots,f_k;\delta_{\TLLnt{A_{\TLLmv{k}}}} \rangle;\mathsf{m};\Box f;\eta_B = \langle f_1,\ldots,f_k \rangle;f : \Gamma \mto \TLLnt{B}.
    \]
    This holds by the following equational reasoning:
    \[\small
    \begin{array}{lll}
      \langle f_1;\delta_{\TLLnt{A_{{\mathrm{1}}}}},\ldots,f_k;\delta_{\TLLnt{A_{\TLLmv{k}}}} \rangle;\mathsf{m};\Box f;\eta_B
      & = & \langle f_1;\delta_{\TLLnt{A_{{\mathrm{1}}}}},\ldots,f_k;\delta_{\TLLnt{A_{\TLLmv{k}}}} \rangle;\mathsf{m};\eta;f\\
      & = & \langle f_1;\delta_{\TLLnt{A_{{\mathrm{1}}}}},\ldots,f_k;\delta_{\TLLnt{A_{\TLLmv{k}}}} \rangle;(\eta_{\TLLnt{A_{{\mathrm{1}}}}} \times \cdots \times \eta_{\TLLnt{A_{\TLLmv{k}}}});f\\
      & = & \langle f_1;\delta_{\TLLnt{A_{{\mathrm{1}}}}};\eta_{\TLLnt{A_{{\mathrm{1}}}}},\ldots,f_k;\delta_{\TLLnt{A_{\TLLmv{k}}}};\eta_{\TLLnt{A_{\TLLmv{k}}}} \rangle;f\\
      & = & \langle f_1,\ldots,f_k \rangle;f\\
    \end{array}
    \]
  \end{itemize}
\end{proof}
% subsubsection proof_of_soundness_of_tcs4 (end)
